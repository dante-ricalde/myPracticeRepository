<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:websocket="http://www.springframework.org/schema/websocket"
	xmlns:int="http://www.springframework.org/schema/integration" xmlns:int-ip="http://www.springframework.org/schema/integration/ip" xmlns:context="http://www.springframework.org/schema/context"
	xmlns:p="http://www.springframework.org/schema/p" xmlns:task="http://www.springframework.org/schema/task" xmlns:int-stomp="http://www.springframework.org/schema/integration/stomp"
	xmlns:int-event="http://www.springframework.org/schema/integration/event" xmlns:c="http://www.springframework.org/schema/c"
	xsi:schemaLocation="http://www.springframework.org/schema/websocket http://www.springframework.org/schema/websocket/spring-websocket-4.1.xsd
		http://www.springframework.org/schema/task http://www.springframework.org/schema/task/spring-task-4.2.xsd
		http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
		http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-4.1.xsd
		http://www.springframework.org/schema/integration/stomp http://www.springframework.org/schema/integration/stomp/spring-integration-stomp-4.2.xsd
		http://www.springframework.org/schema/integration/event http://www.springframework.org/schema/integration/event/spring-integration-event-4.2.xsd
		http://www.springframework.org/schema/integration/ip http://www.springframework.org/schema/integration/ip/spring-integration-ip-4.1.xsd
		http://www.springframework.org/schema/integration http://www.springframework.org/schema/integration/spring-integration-4.1.xsd">

	<int:annotation-config />
	
	<!-- Theory says: Since the Spring Framework WebSocket infrastructure is based on the Spring Messaging foundation and provides a basic Messaging framework based on the same MessageChannel s, MessageHandler s that Spring Integration uses,
	 and some POJO-method annotation mappings, Spring Integration can be directly involved in a WebSocket flow, even without WebSocket adapters. For this purpose you can simply configure a Spring Integration @MessagingGateway
	  with appropriate annotations.
	  
	  In this case my @MessagingGateway is WebSocketGateway and when receives a WebSocket message is processed by the service activator 'greetingChannelSA' which sends its reply to the channel replyGreetingChannel and hence the messages is received by
	   the gateway and int:outbound-channel-adapter because this is a <int:publish-subscribe-channel. The gateway sends its response to the queue '/topic/integrationGreetingResponse' and the int:outbound-channel-adapter also can process that response 
	   and do anything with it. Regarding threads all this process happens in a single thread:
	   
																										   																	=============> @MessagingGateway ==============================================		
																										   																	|																			   |	
	   browser => @MessagingGateway => <int:channel (greetingChannel) === service-activator(greetingChannelSA) => <int:publish-subscribe-channel (replyGreetingChannel)  ====  	 																		    ===> queue (/topic/integrationGreetingResponse)
															   																												|																			   |
															   																												=============> <int:outbound-channel-adapter (replyGreetingChannelOChAdapter)==
	   
	   TRACE [org.springframework.web.socket.messaging.WebSocketAnnotationMethodMessageHandler]  - Found 1 methods: [{[/integrationGreeting],messageType=[MESSAGE]}]
 DEBUG [org.springframework.web.socket.messaging.WebSocketAnnotationMethodMessageHandler]  - Invoking test.org.spring.websocket.api.integration.WebSocketGateway#greeting[2 args]
 DEBUG [org.springframework.integration.channel.DirectChannel]  - preSend on channel 'greetingChannel', message: GenericMessage [payload=ChatMessage [message=Hello Integration STOMP, recipient=app, sender=webapp, destination=null], headers={simpMessageType=MESSAGE, stompCommand=SEND, nativeHeaders={destination=[/appChatRelay/integrationGreeting], content-length=[73]}, replyChannel=org.springframework.messaging.core.GenericMessagingTemplate$TemporaryReplyChannel@c89151, errorChannel=org.springframework.messaging.core.GenericMessagingTemplate$TemporaryReplyChannel@c89151, simpSessionAttributes={HTTP.SESSION.ID=49DF7591F6574D8E4721C4D3E642A040.tc-runtime-1}, simpHeartbeat=[J@168469b8, id=c170b84a-f4b4-e5d8-bce4-2efb86fbaabf, lookupDestination=/integrationGreeting, simpSessionId=mq3tkwoc, simpDestination=/appChatRelay/integrationGreeting, timestamp=1445672180614}]
 DEBUG [org.springframework.integration.handler.ServiceActivatingHandler]  - ServiceActivator for [org.springframework.integration.handler.MethodInvokingMessageProcessor@47036c99] (greetingChannelSA) received message: GenericMessage [payload=ChatMessage [message=Hello Integration STOMP, recipient=app, sender=webapp, destination=null], headers={simpMessageType=MESSAGE, stompCommand=SEND, nativeHeaders={destination=[/appChatRelay/integrationGreeting], content-length=[73]}, replyChannel=org.springframework.messaging.core.GenericMessagingTemplate$TemporaryReplyChannel@c89151, errorChannel=org.springframework.messaging.core.GenericMessagingTemplate$TemporaryReplyChannel@c89151, simpSessionAttributes={HTTP.SESSION.ID=49DF7591F6574D8E4721C4D3E642A040.tc-runtime-1}, simpHeartbeat=[J@168469b8, id=c170b84a-f4b4-e5d8-bce4-2efb86fbaabf, lookupDestination=/integrationGreeting, simpSessionId=mq3tkwoc, simpDestination=/appChatRelay/integrationGreeting, timestamp=1445672180614}]
 DEBUG [org.springframework.integration.channel.PublishSubscribeChannel]  - preSend on channel 'replyGreetingChannel', message: GenericMessage [payload=ChatMessage [message=Modified Hello Integration STOMP, recipient=null, sender=null, destination=null], headers={simpMessageType=MESSAGE, stompCommand=SEND, nativeHeaders={destination=[/appChatRelay/integrationGreeting], content-length=[73]}, replyChannel=org.springframework.messaging.core.GenericMessagingTemplate$TemporaryReplyChannel@c89151, errorChannel=org.springframework.messaging.core.GenericMessagingTemplate$TemporaryReplyChannel@c89151, simpSessionAttributes={HTTP.SESSION.ID=49DF7591F6574D8E4721C4D3E642A040.tc-runtime-1}, simpHeartbeat=[J@168469b8, id=9ed74a9b-e493-f57d-f73e-4685e94cf4b3, lookupDestination=/integrationGreeting, simpSessionId=mq3tkwoc, simpDestination=/appChatRelay/integrationGreeting, timestamp=1445672180615}]
 DEBUG [org.springframework.integration.handler.MethodInvokingMessageHandler]  - org.springframework.integration.handler.MethodInvokingMessageHandler#0 received message: GenericMessage [payload=ChatMessage [message=Modified Hello Integration STOMP, recipient=null, sender=null, destination=null], headers={simpMessageType=MESSAGE, stompCommand=SEND, nativeHeaders={destination=[/appChatRelay/integrationGreeting], content-length=[73]}, replyChannel=org.springframework.messaging.core.GenericMessagingTemplate$TemporaryReplyChannel@c89151, errorChannel=org.springframework.messaging.core.GenericMessagingTemplate$TemporaryReplyChannel@c89151, simpSessionAttributes={HTTP.SESSION.ID=49DF7591F6574D8E4721C4D3E642A040.tc-runtime-1}, simpHeartbeat=[J@168469b8, id=9ed74a9b-e493-f57d-f73e-4685e94cf4b3, lookupDestination=/integrationGreeting, simpSessionId=mq3tkwoc, simpDestination=/appChatRelay/integrationGreeting, timestamp=1445672180615}]
 INFO  [test.org.spring.websocket.api.adapter.receiver.ChannelAdapterReceiver]  - Channel Adapter Receiver: Message Received: GenericMessage [payload=ChatMessage [message=Modified Hello Integration STOMP, recipient=null, sender=null, destination=null], headers={simpMessageType=MESSAGE, stompCommand=SEND, nativeHeaders={destination=[/appChatRelay/integrationGreeting], content-length=[73]}, replyChannel=org.springframework.messaging.core.GenericMessagingTemplate$TemporaryReplyChannel@c89151, errorChannel=org.springframework.messaging.core.GenericMessagingTemplate$TemporaryReplyChannel@c89151, simpSessionAttributes={HTTP.SESSION.ID=49DF7591F6574D8E4721C4D3E642A040.tc-runtime-1}, simpHeartbeat=[J@168469b8, id=9ed74a9b-e493-f57d-f73e-4685e94cf4b3, lookupDestination=/integrationGreeting, simpSessionId=mq3tkwoc, simpDestination=/appChatRelay/integrationGreeting, timestamp=1445672180615}]*********END OF THE MESSAGE *************************
 DEBUG [org.springframework.integration.handler.BridgeHandler]  - org.springframework.integration.handler.BridgeHandler@7c54b304 received message: GenericMessage [payload=ChatMessage [message=Modified Hello Integration STOMP, recipient=null, sender=null, destination=null], headers={simpMessageType=MESSAGE, stompCommand=SEND, nativeHeaders={destination=[/appChatRelay/integrationGreeting], content-length=[73]}, replyChannel=org.springframework.messaging.core.GenericMessagingTemplate$TemporaryReplyChannel@c89151, errorChannel=org.springframework.messaging.core.GenericMessagingTemplate$TemporaryReplyChannel@c89151, simpSessionAttributes={HTTP.SESSION.ID=49DF7591F6574D8E4721C4D3E642A040.tc-runtime-1}, simpHeartbeat=[J@168469b8, id=9ed74a9b-e493-f57d-f73e-4685e94cf4b3, lookupDestination=/integrationGreeting, simpSessionId=mq3tkwoc, simpDestination=/appChatRelay/integrationGreeting, timestamp=1445672180615}]
 DEBUG [org.springframework.integration.channel.PublishSubscribeChannel]  - postSend (sent=true) on channel 'replyGreetingChannel', message: GenericMessage [payload=ChatMessage [message=Modified Hello Integration STOMP, recipient=null, sender=null, destination=null], headers={simpMessageType=MESSAGE, stompCommand=SEND, nativeHeaders={destination=[/appChatRelay/integrationGreeting], content-length=[73]}, replyChannel=org.springframework.messaging.core.GenericMessagingTemplate$TemporaryReplyChannel@c89151, errorChannel=org.springframework.messaging.core.GenericMessagingTemplate$TemporaryReplyChannel@c89151, simpSessionAttributes={HTTP.SESSION.ID=49DF7591F6574D8E4721C4D3E642A040.tc-runtime-1}, simpHeartbeat=[J@168469b8, id=9ed74a9b-e493-f57d-f73e-4685e94cf4b3, lookupDestination=/integrationGreeting, simpSessionId=mq3tkwoc, simpDestination=/appChatRelay/integrationGreeting, timestamp=1445672180615}]
 DEBUG [org.springframework.integration.channel.DirectChannel]  - postSend (sent=true) on channel 'greetingChannel', message: GenericMessage [payload=ChatMessage [message=Hello Integration STOMP, recipient=app, sender=webapp, destination=null], headers={simpMessageType=MESSAGE, stompCommand=SEND, nativeHeaders={destination=[/appChatRelay/integrationGreeting], content-length=[73]}, replyChannel=org.springframework.messaging.core.GenericMessagingTemplate$TemporaryReplyChannel@c89151, errorChannel=org.springframework.messaging.core.GenericMessagingTemplate$TemporaryReplyChannel@c89151, simpSessionAttributes={HTTP.SESSION.ID=49DF7591F6574D8E4721C4D3E642A040.tc-runtime-1}, simpHeartbeat=[J@168469b8, id=c170b84a-f4b4-e5d8-bce4-2efb86fbaabf, lookupDestination=/integrationGreeting, simpSessionId=mq3tkwoc, simpDestination=/appChatRelay/integrationGreeting, timestamp=1445672180614}]
 DEBUG [org.springframework.messaging.simp.stomp.StompBrokerRelayMessageHandler]  - Forwarding SEND /topic/integrationGreetingResponse session=mq3tkwoc application/json;charset=UTF-8 payload={"message":"Modified Hello Integration STOMP","recipient":null,"sender":null,"de...(truncated)
 DEBUG [reactor.io.net.impl.netty.tcp.NettyTcpClient]  - [id: 0xdf763372, /127.0.0.1:59387 => /127.0.0.1:61613] WRITE: 68B
 
	   The another thread for the messages which don't come from the browser:
																																																		   																	=============> @MessagingGateway ==============================================		
																																																		   																	|																			   	   																																																																		
	   <int:inbound-channel-adapter (anotherGreetingChannel) => service-activator (anotherGreetingChannelSA) => @MessagingGateway => <int:channel (greetingChannel) ==> service-activator(greetingChannelSA) ==> <int:publish-subscribe-channel (replyGreetingChannel)  ====
																																																|																			|
																																																															   				=============> <int:outbound-channel-adapter (replyGreetingChannelOChAdapter)==	   
	   In this thread it's necessary to notice that the message is not sent to the queue by the gateway because the message is not a webSocket message but a message generated by the <int:inbound-channel-adapter (anotherGreetingChannel).
	   	
	   	DEBUG [org.springframework.integration.endpoint.SourcePollingChannelAdapter]  - Poll resulted in Message: GenericMessage [payload=ChatMessage [message=Hi Dantito 1, recipient=keluchis, sender=dante, destination=null], headers={className=item, id=ff58b531-2606-b288-1c3e-74eb4f41ad23, timestamp=1445672163770}]
 DEBUG [org.springframework.integration.channel.DirectChannel]  - preSend on channel 'anotherGreetingChannel', message: GenericMessage [payload=ChatMessage [message=Hi Dantito 1, recipient=keluchis, sender=dante, destination=null], headers={className=item, id=ff58b531-2606-b288-1c3e-74eb4f41ad23, timestamp=1445672163770}]
 DEBUG [org.springframework.integration.handler.ServiceActivatingHandler]  - ServiceActivator for [org.springframework.integration.handler.MethodInvokingMessageProcessor@44bd9872] (anotherGreetingChannelSA) received message: GenericMessage [payload=ChatMessage [message=Hi Dantito 1, recipient=keluchis, sender=dante, destination=null], headers={className=item, id=ff58b531-2606-b288-1c3e-74eb4f41ad23, timestamp=1445672163770}]
 DEBUG [org.springframework.integration.channel.DirectChannel]  - preSend on channel 'greetingChannel', message: GenericMessage [payload=ChatMessage [message=Hi Dantito 1, recipient=keluchis, sender=dante, destination=null], headers={replyChannel=org.springframework.messaging.core.GenericMessagingTemplate$TemporaryReplyChannel@7bc12918, className=item, errorChannel=org.springframework.messaging.core.GenericMessagingTemplate$TemporaryReplyChannel@7bc12918, id=af718828-9348-5c81-02b5-00f95b713711, timestamp=1445672163772}]
 DEBUG [org.springframework.integration.handler.ServiceActivatingHandler]  - ServiceActivator for [org.springframework.integration.handler.MethodInvokingMessageProcessor@47036c99] (greetingChannelSA) received message: GenericMessage [payload=ChatMessage [message=Hi Dantito 1, recipient=keluchis, sender=dante, destination=null], headers={replyChannel=org.springframework.messaging.core.GenericMessagingTemplate$TemporaryReplyChannel@7bc12918, className=item, errorChannel=org.springframework.messaging.core.GenericMessagingTemplate$TemporaryReplyChannel@7bc12918, id=af718828-9348-5c81-02b5-00f95b713711, timestamp=1445672163772}]
 DEBUG [org.springframework.integration.channel.PublishSubscribeChannel]  - preSend on channel 'replyGreetingChannel', message: GenericMessage [payload=ChatMessage [message=Modified Hi Dantito 1, recipient=null, sender=null, destination=null], headers={replyChannel=org.springframework.messaging.core.GenericMessagingTemplate$TemporaryReplyChannel@7bc12918, className=item, errorChannel=org.springframework.messaging.core.GenericMessagingTemplate$TemporaryReplyChannel@7bc12918, id=7efd5afc-e874-f34d-c77b-ca620cfddad4, timestamp=1445672163773}]
 DEBUG [org.springframework.integration.handler.MethodInvokingMessageHandler]  - org.springframework.integration.handler.MethodInvokingMessageHandler#0 received message: GenericMessage [payload=ChatMessage [message=Modified Hi Dantito 1, recipient=null, sender=null, destination=null], headers={replyChannel=org.springframework.messaging.core.GenericMessagingTemplate$TemporaryReplyChannel@7bc12918, className=item, errorChannel=org.springframework.messaging.core.GenericMessagingTemplate$TemporaryReplyChannel@7bc12918, id=7efd5afc-e874-f34d-c77b-ca620cfddad4, timestamp=1445672163773}]
 INFO  [test.org.spring.websocket.api.adapter.receiver.ChannelAdapterReceiver]  - Channel Adapter Receiver: Message Received: GenericMessage [payload=ChatMessage [message=Modified Hi Dantito 1, recipient=null, sender=null, destination=null], headers={replyChannel=org.springframework.messaging.core.GenericMessagingTemplate$TemporaryReplyChannel@7bc12918, className=item, errorChannel=org.springframework.messaging.core.GenericMessagingTemplate$TemporaryReplyChannel@7bc12918, id=7efd5afc-e874-f34d-c77b-ca620cfddad4, timestamp=1445672163773}]*********END OF THE MESSAGE *************************
 DEBUG [org.springframework.integration.handler.BridgeHandler]  - org.springframework.integration.handler.BridgeHandler@7c54b304 received message: GenericMessage [payload=ChatMessage [message=Modified Hi Dantito 1, recipient=null, sender=null, destination=null], headers={replyChannel=org.springframework.messaging.core.GenericMessagingTemplate$TemporaryReplyChannel@7bc12918, className=item, errorChannel=org.springframework.messaging.core.GenericMessagingTemplate$TemporaryReplyChannel@7bc12918, id=7efd5afc-e874-f34d-c77b-ca620cfddad4, timestamp=1445672163773}]
 DEBUG [org.springframework.integration.channel.PublishSubscribeChannel]  - postSend (sent=true) on channel 'replyGreetingChannel', message: GenericMessage [payload=ChatMessage [message=Modified Hi Dantito 1, recipient=null, sender=null, destination=null], headers={replyChannel=org.springframework.messaging.core.GenericMessagingTemplate$TemporaryReplyChannel@7bc12918, className=item, errorChannel=org.springframework.messaging.core.GenericMessagingTemplate$TemporaryReplyChannel@7bc12918, id=7efd5afc-e874-f34d-c77b-ca620cfddad4, timestamp=1445672163773}]
 DEBUG [org.springframework.integration.channel.DirectChannel]  - postSend (sent=true) on channel 'greetingChannel', message: GenericMessage [payload=ChatMessage [message=Hi Dantito 1, recipient=keluchis, sender=dante, destination=null], headers={replyChannel=org.springframework.messaging.core.GenericMessagingTemplate$TemporaryReplyChannel@7bc12918, className=item, errorChannel=org.springframework.messaging.core.GenericMessagingTemplate$TemporaryReplyChannel@7bc12918, id=af718828-9348-5c81-02b5-00f95b713711, timestamp=1445672163772}]
 DEBUG [test.org.spring.websocket.api.handler.serviceActivator.GatewayInvoker]  - Gateway response:ChatMessage [message=Modified Hi Dantito 1, recipient=null, sender=null, destination=null]
 DEBUG [org.springframework.integration.handler.ServiceActivatingHandler]  - handler 'ServiceActivator for [org.springframework.integration.handler.MethodInvokingMessageProcessor@44bd9872] (anotherGreetingChannelSA)' produced no reply for request Message: GenericMessage [payload=ChatMessage [message=Hi Dantito 1, recipient=keluchis, sender=dante, destination=null], headers={className=item, id=ff58b531-2606-b288-1c3e-74eb4f41ad23, timestamp=1445672163770}]
 DEBUG [org.springframework.integration.channel.DirectChannel]  - postSend (sent=true) on channel 'anotherGreetingChannel', message: GenericMessage [payload=ChatMessage [message=Hi Dantito 1, recipient=keluchis, sender=dante, destination=null], headers={className=item, id=ff58b531-2606-b288-1c3e-74eb4f41ad23, timestamp=1445672163770}]
	   
	   -->
	<int:channel id="greetingChannel" />

	<int:publish-subscribe-channel id="replyGreetingChannel" />

	<!-- <int:channel id="greetingErrorChannel" /> -->

<!-- 	<int:gateway id="myWebSocketGateway" service-interface="test.org.spring.websocket.api.integration.WebSocketGateway" default-request-channel="greetingChannel" -->
<!-- 		default-reply-channel="replyGreetingChannel"> -->
<!-- 		<int:method name="greeting" request-channel="greetingChannel" reply-channel="replyGreetingChannel"></int:method> -->
<!-- 	</int:gateway> -->

	<int:service-activator id="greetingChannelSA" input-channel="greetingChannel" ref="gatewayProcessor" output-channel="replyGreetingChannel" auto-startup="true" />

	<int:inbound-channel-adapter id="anotherGreetingChannel"
		expression="T(java.lang.Math).random() > 0.5 ? T(org.springframework.integration.support.MessageBuilder).withPayload(new test.org.spring.websocket.api.model.ChatMessage('Hi Dantito 1', 'dante', 'keluchis')).setHeader('className', 'item').build():
		T(org.springframework.integration.support.MessageBuilder).withPayload(new test.org.spring.websocket.api.model.ChatMessage('Hi Danielito 1', 'dante', 'keluchis')).setHeader('className', 'item').build()"
		auto-startup="true">
		<int:poller fixed-rate="20000" />
	</int:inbound-channel-adapter>

	<int:service-activator id="anotherGreetingChannelSA" input-channel="anotherGreetingChannel" ref="gatewayInvoker" auto-startup="true" />
	
<!-- 	<bean class="org.springframework.messaging.converter.MappingJackson2MessageConverter" /> -->

	<int:outbound-channel-adapter id="replyGreetingChannelOChAdapter" channel="replyGreetingChannel" ref="channelAdapterReceiver" method="receiveMessage"
		auto-startup="true" />
		
	<!-- This case is similar to the previous one, the difference is that when a WebSocket message arrives to the @MessagingGateway the original message is forwarded to be processed by the service activator (greetingChannelSA1) an
	<int:outbound-channel-adapter (replyGreetingChannelOChAdapter1). The service activator in this case modifies the message and return it to the @MessagingGateway to be sent to the queue (/topic/integrationGreetingResponse) later.
	
	This case only applies to the the messages which come from the browser.
	
	The thread path would be:
																							========>  service-activator(greetingChannelSA1) => @MessagingGateway     ======> 
																						   |																			    |
	browser => @MessagingGateway ==> <int:publish-subscribe-channel (greetingChannel1) ====																					 ========> queue (/topic/integrationGreetingResponse)			
																						   |																				|
																							========> <int:outbound-channel-adapter	(replyGreetingChannelOChAdapter1) ======
	   The logs are:
	   
	   INFO  [org.springframework.integration.endpoint.EventDrivenConsumer]  - started org.springframework.integration.endpoint.EventDrivenConsumer@4c715e5f
 DEBUG [org.springframework.integration.channel.PublishSubscribeChannel]  - preSend on channel 'greetingChannel1', message: GenericMessage [payload=ChatMessage [message=Hello Integration STOMP, recipient=app, sender=webapp, destination=null], headers={simpMessageType=MESSAGE, stompCommand=SEND, nativeHeaders={destination=[/appChatRelay/integrationGreeting1], content-length=[73]}, replyChannel=org.springframework.messaging.core.GenericMessagingTemplate$TemporaryReplyChannel@484ec309, errorChannel=org.springframework.messaging.core.GenericMessagingTemplate$TemporaryReplyChannel@484ec309, simpSessionAttributes={HTTP.SESSION.ID=49DF7591F6574D8E4721C4D3E642A040.tc-runtime-1}, simpHeartbeat=[J@d4c5464, id=3238be3e-e547-ae2c-5a7e-df675c389d21, lookupDestination=/integrationGreeting1, simpSessionId=mq3tkwoc, simpDestination=/appChatRelay/integrationGreeting1, timestamp=1445672185524}]
 DEBUG [org.springframework.integration.handler.ServiceActivatingHandler]  - ServiceActivator for [org.springframework.integration.handler.MethodInvokingMessageProcessor@7a4ed0d4] (greetingChannelSA1) received message: GenericMessage [payload=ChatMessage [message=Hello Integration STOMP, recipient=app, sender=webapp, destination=null], headers={simpMessageType=MESSAGE, stompCommand=SEND, nativeHeaders={destination=[/appChatRelay/integrationGreeting1], content-length=[73]}, replyChannel=org.springframework.messaging.core.GenericMessagingTemplate$TemporaryReplyChannel@484ec309, errorChannel=org.springframework.messaging.core.GenericMessagingTemplate$TemporaryReplyChannel@484ec309, simpSessionAttributes={HTTP.SESSION.ID=49DF7591F6574D8E4721C4D3E642A040.tc-runtime-1}, simpHeartbeat=[J@d4c5464, id=3238be3e-e547-ae2c-5a7e-df675c389d21, lookupDestination=/integrationGreeting1, simpSessionId=mq3tkwoc, simpDestination=/appChatRelay/integrationGreeting1, timestamp=1445672185524}]
 DEBUG [org.springframework.integration.channel.DirectChannel]  - preSend on channel 'replyGreetingChannel1', message: GenericMessage [payload=ChatMessage [message=Modified Hello Integration STOMP, recipient=null, sender=null, destination=null], headers={simpMessageType=MESSAGE, stompCommand=SEND, nativeHeaders={destination=[/appChatRelay/integrationGreeting1], content-length=[73]}, replyChannel=org.springframework.messaging.core.GenericMessagingTemplate$TemporaryReplyChannel@484ec309, errorChannel=org.springframework.messaging.core.GenericMessagingTemplate$TemporaryReplyChannel@484ec309, simpSessionAttributes={HTTP.SESSION.ID=49DF7591F6574D8E4721C4D3E642A040.tc-runtime-1}, simpHeartbeat=[J@d4c5464, id=0636ecab-ef9b-29ec-6432-4ef89d1fe59b, lookupDestination=/integrationGreeting1, simpSessionId=mq3tkwoc, simpDestination=/appChatRelay/integrationGreeting1, timestamp=1445672185526}]
 DEBUG [org.springframework.integration.handler.BridgeHandler]  - org.springframework.integration.handler.BridgeHandler@3c8bfa64 received message: GenericMessage [payload=ChatMessage [message=Modified Hello Integration STOMP, recipient=null, sender=null, destination=null], headers={simpMessageType=MESSAGE, stompCommand=SEND, nativeHeaders={destination=[/appChatRelay/integrationGreeting1], content-length=[73]}, replyChannel=org.springframework.messaging.core.GenericMessagingTemplate$TemporaryReplyChannel@484ec309, errorChannel=org.springframework.messaging.core.GenericMessagingTemplate$TemporaryReplyChannel@484ec309, simpSessionAttributes={HTTP.SESSION.ID=49DF7591F6574D8E4721C4D3E642A040.tc-runtime-1}, simpHeartbeat=[J@d4c5464, id=0636ecab-ef9b-29ec-6432-4ef89d1fe59b, lookupDestination=/integrationGreeting1, simpSessionId=mq3tkwoc, simpDestination=/appChatRelay/integrationGreeting1, timestamp=1445672185526}]
 DEBUG [org.springframework.integration.channel.DirectChannel]  - postSend (sent=true) on channel 'replyGreetingChannel1', message: GenericMessage [payload=ChatMessage [message=Modified Hello Integration STOMP, recipient=null, sender=null, destination=null], headers={simpMessageType=MESSAGE, stompCommand=SEND, nativeHeaders={destination=[/appChatRelay/integrationGreeting1], content-length=[73]}, replyChannel=org.springframework.messaging.core.GenericMessagingTemplate$TemporaryReplyChannel@484ec309, errorChannel=org.springframework.messaging.core.GenericMessagingTemplate$TemporaryReplyChannel@484ec309, simpSessionAttributes={HTTP.SESSION.ID=49DF7591F6574D8E4721C4D3E642A040.tc-runtime-1}, simpHeartbeat=[J@d4c5464, id=0636ecab-ef9b-29ec-6432-4ef89d1fe59b, lookupDestination=/integrationGreeting1, simpSessionId=mq3tkwoc, simpDestination=/appChatRelay/integrationGreeting1, timestamp=1445672185526}]
 DEBUG [org.springframework.integration.handler.MethodInvokingMessageHandler]  - org.springframework.integration.handler.MethodInvokingMessageHandler#1 received message: GenericMessage [payload=ChatMessage [message=Hello Integration STOMP, recipient=app, sender=webapp, destination=null], headers={simpMessageType=MESSAGE, stompCommand=SEND, nativeHeaders={destination=[/appChatRelay/integrationGreeting1], content-length=[73]}, replyChannel=org.springframework.messaging.core.GenericMessagingTemplate$TemporaryReplyChannel@484ec309, errorChannel=org.springframework.messaging.core.GenericMessagingTemplate$TemporaryReplyChannel@484ec309, simpSessionAttributes={HTTP.SESSION.ID=49DF7591F6574D8E4721C4D3E642A040.tc-runtime-1}, simpHeartbeat=[J@d4c5464, id=3238be3e-e547-ae2c-5a7e-df675c389d21, lookupDestination=/integrationGreeting1, simpSessionId=mq3tkwoc, simpDestination=/appChatRelay/integrationGreeting1, timestamp=1445672185524}]
 INFO  [test.org.spring.websocket.api.adapter.receiver.ChannelAdapterReceiver]  - Channel Adapter Receiver: Message Received: GenericMessage [payload=ChatMessage [message=Hello Integration STOMP, recipient=app, sender=webapp, destination=null], headers={simpMessageType=MESSAGE, stompCommand=SEND, nativeHeaders={destination=[/appChatRelay/integrationGreeting1], content-length=[73]}, replyChannel=org.springframework.messaging.core.GenericMessagingTemplate$TemporaryReplyChannel@484ec309, errorChannel=org.springframework.messaging.core.GenericMessagingTemplate$TemporaryReplyChannel@484ec309, simpSessionAttributes={HTTP.SESSION.ID=49DF7591F6574D8E4721C4D3E642A040.tc-runtime-1}, simpHeartbeat=[J@d4c5464, id=3238be3e-e547-ae2c-5a7e-df675c389d21, lookupDestination=/integrationGreeting1, simpSessionId=mq3tkwoc, simpDestination=/appChatRelay/integrationGreeting1, timestamp=1445672185524}]*********END OF THE MESSAGE *************************
 DEBUG [org.springframework.integration.channel.PublishSubscribeChannel]  - postSend (sent=true) on channel 'greetingChannel1', message: GenericMessage [payload=ChatMessage [message=Hello Integration STOMP, recipient=app, sender=webapp, destination=null], headers={simpMessageType=MESSAGE, stompCommand=SEND, nativeHeaders={destination=[/appChatRelay/integrationGreeting1], content-length=[73]}, replyChannel=org.springframework.messaging.core.GenericMessagingTemplate$TemporaryReplyChannel@484ec309, errorChannel=org.springframework.messaging.core.GenericMessagingTemplate$TemporaryReplyChannel@484ec309, simpSessionAttributes={HTTP.SESSION.ID=49DF7591F6574D8E4721C4D3E642A040.tc-runtime-1}, simpHeartbeat=[J@d4c5464, id=3238be3e-e547-ae2c-5a7e-df675c389d21, lookupDestination=/integrationGreeting1, simpSessionId=mq3tkwoc, simpDestination=/appChatRelay/integrationGreeting1, timestamp=1445672185524}]
 DEBUG [org.springframework.messaging.simp.stomp.StompBrokerRelayMessageHandler]  - Forwarding SEND /topic/integrationGreetingResponse session=mq3tkwoc application/json;charset=UTF-8 payload={"message":"Modified Hello Integration STOMP","recipient":null,"sender":null,"de...(truncated)
 DEBUG [reactor.io.net.impl.netty.tcp.NettyTcpClient]  - [id: 0xdf763372, /127.0.0.1:59387 => /127.0.0.1:61613] WRITE: 212B
	   
	   -->
	
	<int:publish-subscribe-channel id="greetingChannel1" />
	
	<int:channel id="replyGreetingChannel1" />

	<int:service-activator id="greetingChannelSA1" input-channel="greetingChannel1" ref="gatewayProcessor" output-channel="replyGreetingChannel1" auto-startup="true" />

	<int:outbound-channel-adapter id="replyGreetingChannelOChAdapter1" channel="greetingChannel1" ref="channelAdapterReceiver" method="receiveMessage"
		auto-startup="true" />
	
</beans>
