00000000: 24 28 66 75 6e 63 74 69 6f 6e 20 28 29 20 7b 0d $(function () {.
00000010: 0a 09 0d 0a 20 20 20 20 24 28 64 6f 63 75 6d 65 .... $(docume
00000020: 6e 74 29 2e 61 6a 61 78 53 65 6e 64 28 66 75 6e nt).ajaxSend(fun
00000030: 63 74 69 6f 6e 28 65 2c 20 78 68 72 2c 20 6f 70 ction(e, xhr, op
00000040: 74 69 6f 6e 73 29 20 7b 0d 0a 20 20 20 20 20 20 tions) {..
00000050: 20 20 78 68 72 2e 73 65 74 52 65 71 75 65 73 74 xhr.setRequest
00000060: 48 65 61 64 65 72 28 24 28 22 6d 65 74 61 5b 6e Header($("meta[n
00000070: 61 6d 65 3d 27 5f 63 73 72 66 5f 68 65 61 64 65 ame='_csrf_heade
00000080: 72 27 5d 22 29 2e 61 74 74 72 28 22 63 6f 6e 74 r']").attr("cont
00000090: 65 6e 74 22 29 2c 20 24 28 22 6d 65 74 61 5b 6e ent"), $("meta[n
000000a0: 61 6d 65 3d 27 5f 63 73 72 66 27 5d 22 29 2e 61 ame='_csrf']").a
000000b0: 74 74 72 28 22 63 6f 6e 74 65 6e 74 22 29 29 3b ttr("content"));
000000c0: 0d 0a 20 20 20 20 7d 29 3b 0d 0a 20 20 20 20 0d .. });.. .
000000d0: 0a 20 20 20 20 76 61 72 20 6f 70 74 69 6f 6e 73 . var options
000000e0: 20 3d 20 7b 0d 0a 20 20 20 20 09 09 70 61 72 61 = {.. ..para
000000f0: 6d 73 3a 20 24 28 27 23 63 68 61 74 43 6f 6e 74 ms: $('#chatCont
00000100: 65 6e 74 27 29 2e 64 61 74 61 28 27 70 61 72 61 ent').data('para
00000110: 6d 73 27 29 2c 0d 0a 20 20 20 20 09 09 63 68 61 ms'),.. ..cha
00000120: 74 56 69 65 77 3a 20 7b 0d 0a 20 20 20 20 09 09 tView: {.. ..
00000130: 09 77 69 64 74 68 3a 20 34 35 30 2c 0d 0a 09 09 .width: 450,....
00000140: 09 09 68 65 69 67 68 74 3a 20 33 35 30 0d 0a 20 ..height: 350..
00000150: 20 20 20 09 09 7d 0d 0a 20 20 20 20 7d 3b 0d 0a ..}.. };..
00000160: 20 20 20 20 0d 0a 20 20 20 20 24 28 27 23 63 68 .. $('#ch
00000170: 61 74 43 6f 6e 74 65 6e 74 27 29 2e 63 68 61 74 atContent').chat
00000180: 28 6f 70 74 69 6f 6e 73 29 3b 0d 0a 20 20 20 20 (options);..
00000190: 0d 0a 2f 2f 20 54 68 69 73 20 64 69 64 6e 27 74 ..// This didn't
000001a0: 20 77 6f 72 6b 20 74 6f 20 6d 61 6b 65 20 61 6e work to make an
000001b0: 20 61 6a 61 78 20 63 61 6c 6c 20 77 69 74 68 20 ajax call with
000001c0: 62 61 73 69 63 20 61 75 74 68 6f 72 69 7a 61 74 basic authorizat
000001d0: 69 6f 6e 2e 20 49 74 20 61 6c 77 61 79 73 20 72 ion. It always r
000001e0: 65 73 70 6f 6e 73 65 20 34 30 35 20 4e 4f 54 20 esponse 405 NOT
000001f0: 41 4c 4c 4f 57 45 44 2c 20 61 6e 64 20 61 6c 77 ALLOWED, and alw
00000200: 61 79 73 20 6d 61 6b 65 73 20 66 69 72 73 74 20 ays makes first
00000210: 61 20 70 72 65 66 6c 69 67 68 74 20 63 61 6c 6c a preflight call
00000220: 20 4f 50 54 49 4f 4e 53 20 0d 0a 2f 2f 20 62 65 OPTIONS ..// be
00000230: 66 6f 72 65 20 73 65 6e 64 20 74 68 65 20 50 4f fore send the PO
00000240: 53 54 20 72 65 71 75 65 73 74 0d 0a 2f 2f 20 20 ST request..//
00000250: 20 20 24 2e 70 6f 73 74 28 27 68 74 74 70 3a 2f $.post('http:/
00000260: 2f 6c 6f 63 61 6c 68 6f 73 74 3a 31 35 36 37 32 /localhost:15672
00000270: 2f 61 70 69 2f 71 75 65 75 65 73 2f 76 68 6f 73 /api/queues/vhos
00000280: 74 2f 6d 65 73 73 61 67 65 73 2d 64 61 6e 74 65 t/messages-dante
00000290: 2d 6b 65 6c 75 63 68 69 73 2f 67 65 74 27 2c 20 -keluchis/get',
000002a0: 7b 75 73 65 72 6e 61 6d 65 3a 20 27 67 75 65 73 {username: 'gues
000002b0: 74 27 2c 70 61 73 73 77 6f 72 64 3a 27 67 75 65 t',password:'gue
000002c0: 73 74 27 7d 2c 20 66 75 6e 63 74 69 6f 6e 28 20 st'}, function(
000002d0: 64 61 74 61 20 29 20 7b 0d 0a 2f 2f 09 09 63 6f data ) {..//..co
000002e0: 6e 73 6f 6c 65 2e 6c 6f 67 28 22 64 61 74 61 20 nsole.log("data
000002f0: 72 65 63 65 69 76 65 64 20 66 6f 72 20 22 20 2b received for " +
00000300: 20 64 61 74 61 29 3b 0d 0a 2f 2f 09 09 0d 0a 2f data);..//..../
00000310: 2f 09 7d 29 3b 0d 0a 20 20 20 20 0d 0a 20 2f 2f /.});.. .. //
00000320: 20 54 68 69 73 20 64 69 64 6e 27 74 20 77 6f 72 This didn't wor
00000330: 6b 20 74 6f 20 6d 61 6b 65 20 61 6e 20 61 6a 61 k to make an aja
00000340: 78 20 63 61 6c 6c 20 77 69 74 68 20 62 61 73 69 x call with basi
00000350: 63 20 61 75 74 68 6f 72 69 7a 61 74 69 6f 6e 2e c authorization.
00000360: 20 49 74 20 61 6c 77 61 79 73 20 72 65 73 70 6f It always respo
00000370: 6e 73 65 20 34 30 35 20 4e 4f 54 20 41 4c 4c 4f nse 405 NOT ALLO
00000380: 57 45 44 2c 20 61 6e 64 20 61 6c 77 61 79 73 20 WED, and always
00000390: 6d 61 6b 65 73 20 66 69 72 73 74 20 61 20 70 72 makes first a pr
000003a0: 65 66 6c 69 67 68 74 20 63 61 6c 6c 20 4f 50 54 eflight call OPT
000003b0: 49 4f 4e 53 20 0d 0a 20 2f 2f 20 62 65 66 6f 72 IONS .. // befor
000003c0: 65 20 73 65 6e 64 20 74 68 65 20 50 4f 53 54 20 e send the POST
000003d0: 72 65 71 75 65 73 74 0d 0a 20 20 20 20 2f 2a 76 request.. /*v
000003e0: 61 72 20 72 65 71 20 3d 20 24 2e 61 6a 61 78 28 ar req = $.ajax(
000003f0: 7b 20 20 20 20 09 20 20 0d 0a 20 20 20 20 09 20 { . .. .
00000400: 20 74 79 70 65 3a 20 27 50 4f 53 54 27 2c 0d 0a type: 'POST',..
00000410: 20 20 20 20 09 20 20 75 72 6c 3a 20 22 68 74 74 . url: "htt
00000420: 70 3a 2f 2f 6c 6f 63 61 6c 68 6f 73 74 3a 31 35 p://localhost:15
00000430: 36 37 32 2f 61 70 69 2f 71 75 65 75 65 73 2f 25 672/api/queues/%
00000440: 32 46 2f 6d 65 73 73 61 67 65 73 2d 64 61 6e 74 2F/messages-dant
00000450: 65 2d 6b 65 6c 75 63 68 69 73 2f 67 65 74 22 2c e-keluchis/get",
00000460: 0d 0a 20 20 20 20 09 20 20 68 65 61 64 65 72 73 .. . headers
00000470: 3a 20 7b 0d 0a 20 20 20 20 09 09 20 20 20 20 22 : {.. .. "
00000480: 41 75 74 68 6f 72 69 7a 61 74 69 6f 6e 22 3a 20 Authorization":
00000490: 22 42 61 73 69 63 20 5a 33 56 6c 63 33 51 36 5a "Basic Z3Vlc3Q6Z
000004a0: 33 56 6c 63 33 51 3d 22 0d 0a 20 20 20 20 09 09 3Vlc3Q=".. ..
000004b0: 20 20 7d 2c 0d 0a 20 20 20 20 09 20 20 64 61 74 },.. . dat
000004c0: 61 3a 20 7b 22 63 6f 75 6e 74 22 3a 35 2c 22 72 a: {"count":5,"r
000004d0: 65 71 75 65 75 65 22 3a 74 72 75 65 2c 22 65 6e equeue":true,"en
000004e0: 63 6f 64 69 6e 67 22 3a 22 61 75 74 6f 22 2c 22 coding":"auto","
000004f0: 74 72 75 6e 63 61 74 65 22 3a 35 30 30 30 30 7d truncate":50000}
00000500: 2c 0d 0a 20 20 20 20 09 20 20 63 6f 6e 74 65 6e ,.. . conten
00000510: 74 54 79 70 65 3a 20 22 61 70 70 6c 69 63 61 74 tType: "applicat
00000520: 69 6f 6e 2f 6a 73 6f 6e 22 2c 20 20 20 20 09 20 ion/json", .
00000530: 20 0d 0a 20 20 20 20 09 20 20 75 73 65 72 6e 61 .. . userna
00000540: 6d 65 3a 20 27 67 75 65 73 74 27 2c 0d 0a 20 20 me: 'guest',..
00000550: 20 20 09 20 20 70 61 73 73 77 6f 72 64 3a 20 27 . password: '
00000560: 67 75 65 73 74 27 2c 0d 0a 20 20 20 20 09 20 20 guest',.. .
00000570: 78 68 72 46 69 65 6c 64 73 3a 20 7b 0d 0a 20 20 xhrFields: {..
00000580: 20 20 09 20 20 20 20 20 20 20 20 20 77 69 74 68 . with
00000590: 43 72 65 64 65 6e 74 69 61 6c 73 3a 20 74 72 75 Credentials: tru
000005a0: 65 0d 0a 20 20 20 20 09 20 20 20 20 7d 2c 0d 0a e.. . },..
000005b0: 20 20 20 20 09 20 20 62 65 66 6f 72 65 53 65 6e . beforeSen
000005c0: 64 3a 20 66 75 6e 63 74 69 6f 6e 20 28 78 68 72 d: function (xhr
000005d0: 29 20 7b 0d 0a 20 20 20 20 20 20 09 09 78 68 72 ) {.. ..xhr
000005e0: 2e 73 65 74 52 65 71 75 65 73 74 48 65 61 64 65 .setRequestHeade
000005f0: 72 28 22 41 75 74 68 6f 72 69 7a 61 74 69 6f 6e r("Authorization
00000600: 22 2c 20 22 42 61 73 69 63 20 5a 33 56 6c 63 33 ", "Basic Z3Vlc3
00000610: 51 36 5a 33 56 6c 63 33 51 3d 22 29 3b 0d 0a 20 Q6Z3Vlc3Q=");..
00000620: 20 20 20 20 20 09 09 7d 0d 0a 20 20 20 20 09 7d ..}.. .}
00000630: 29 0d 0a 20 20 20 20 09 20 20 2e 64 6f 6e 65 28 ).. . .done(
00000640: 66 75 6e 63 74 69 6f 6e 28 20 6d 73 67 20 29 20 function( msg )
00000650: 7b 0d 0a 20 20 20 20 09 20 20 20 20 61 6c 65 72 {.. . aler
00000660: 74 28 20 22 44 61 74 61 20 53 61 76 65 64 3a 20 t( "Data Saved:
00000670: 22 20 2b 20 6d 73 67 20 29 3b 0d 0a 20 20 20 20 " + msg );..
00000680: 09 20 20 7d 29 2e 66 61 69 6c 28 66 75 6e 63 74 . }).fail(funct
00000690: 69 6f 6e 20 28 29 20 7b 0d 0a 20 20 20 20 09 09 ion () {.. ..
000006a0: 20 20 63 6f 6e 73 6f 6c 65 2e 6c 6f 67 28 27 66 console.log('f
000006b0: 61 69 6c 65 64 27 29 3b 0d 0a 20 20 20 20 09 09 ailed');.. ..
000006c0: 20 20 0d 0a 20 20 20 20 09 20 20 7d 29 2e 61 6c .. . }).al
000006d0: 77 61 79 73 28 66 75 6e 63 74 69 6f 6e 20 28 29 ways(function ()
000006e0: 20 7b 0d 0a 20 20 20 20 09 09 20 20 63 6f 6e 73 {.. .. cons
000006f0: 6f 6c 65 2e 6c 6f 67 28 27 61 6c 77 61 79 73 27 ole.log('always'
00000700: 29 3b 0d 0a 20 20 20 20 09 20 20 7d 29 3b 20 20 );.. . });
00000710: 20 2a 2f 0d 0a 20 20 20 20 0d 0a 20 7d 29 3b 0d */.. .. });.
00000720: 0a .