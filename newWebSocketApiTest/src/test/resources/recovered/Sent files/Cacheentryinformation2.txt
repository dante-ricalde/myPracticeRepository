00000000: 2f 2a 2a 0d 0a 20 2a 20 6a 51 75 65 72 79 20 63 /**.. * jQuery c
00000010: 68 61 74 20 70 6c 75 67 69 6e 0d 0a 20 2a 20 52 hat plugin.. * R
00000020: 65 71 75 69 72 65 3a 20 0d 0a 20 2a 20 09 2d 20 equire: .. * .-
00000030: 6a 71 75 65 72 79 0d 0a 20 2a 2f 0d 0a 24 28 66 jquery.. */..$(f
00000040: 75 6e 63 74 69 6f 6e 20 28 29 20 7b 0d 0a 09 0d unction () {....
00000050: 0a 09 22 75 73 65 20 73 74 72 69 63 74 22 3b 0d .."use strict";.
00000060: 0a 09 0d 0a 09 69 66 20 28 21 24 2e 63 68 61 74 .....if (!$.chat
00000070: 29 20 7b 0d 0a 09 09 24 2e 63 68 61 74 20 3d 20 ) {....$.chat =
00000080: 7b 7d 3b 0d 0a 09 7d 0d 0a 09 0d 0a 20 20 20 20 {};...}.....
00000090: 24 28 64 6f 63 75 6d 65 6e 74 29 2e 61 6a 61 78 $(document).ajax
000000a0: 53 65 6e 64 28 66 75 6e 63 74 69 6f 6e 28 65 2c Send(function(e,
000000b0: 20 78 68 72 2c 20 6f 70 74 69 6f 6e 73 29 20 7b xhr, options) {
000000c0: 0d 0a 20 20 20 20 20 20 20 20 78 68 72 2e 73 65 .. xhr.se
000000d0: 74 52 65 71 75 65 73 74 48 65 61 64 65 72 28 24 tRequestHeader($
000000e0: 28 22 6d 65 74 61 5b 6e 61 6d 65 3d 27 5f 63 73 ("meta[name='_cs
000000f0: 72 66 5f 68 65 61 64 65 72 27 5d 22 29 2e 61 74 rf_header']").at
00000100: 74 72 28 22 63 6f 6e 74 65 6e 74 22 29 2c 20 24 tr("content"), $
00000110: 28 22 6d 65 74 61 5b 6e 61 6d 65 3d 27 5f 63 73 ("meta[name='_cs
00000120: 72 66 27 5d 22 29 2e 61 74 74 72 28 22 63 6f 6e rf']").attr("con
00000130: 74 65 6e 74 22 29 29 3b 0d 0a 20 20 20 20 7d 29 tent"));.. })
00000140: 3b 20 20 20 0d 0a 20 20 20 20 0d 0a 20 20 20 20 ; .. ..
00000150: 76 61 72 20 6d 65 74 68 6f 64 73 20 3d 20 7b 0d var methods = {.
00000160: 0a 20 20 20 20 09 09 5f 69 6e 69 74 3a 20 66 75 . .._init: fu
00000170: 6e 63 74 69 6f 6e 20 28 6f 70 74 69 6f 6e 73 29 nction (options)
00000180: 20 7b 0d 0a 20 20 20 20 09 09 09 63 6f 6e 73 6f {.. ...conso
00000190: 6c 65 2e 6c 6f 67 28 22 5f 69 6e 69 74 20 69 6e le.log("_init in
000001a0: 76 6f 6b 65 64 20 77 69 74 68 20 6f 70 74 69 6f voked with optio
000001b0: 6e 73 3a 20 22 20 2b 20 6f 70 74 69 6f 6e 73 29 ns: " + options)
000001c0: 3b 0d 0a 20 20 20 20 09 09 09 76 61 72 20 73 65 ;.. ...var se
000001d0: 74 74 69 6e 67 73 20 3d 20 7b 0d 0a 20 20 20 20 ttings = {..
000001e0: 09 09 09 09 6c 61 6e 67 75 61 67 65 3a 20 22 65 ....language: "e
000001f0: 6e 22 2c 0d 0a 20 20 20 20 09 09 09 09 63 68 61 n",.. ....cha
00000200: 74 56 69 65 77 3a 20 7b 0d 0a 20 20 20 20 09 09 tView: {.. ..
00000210: 09 09 09 77 69 64 74 68 3a 20 35 30 30 2c 0d 0a ...width: 500,..
00000220: 20 20 20 20 09 09 09 09 09 68 65 69 67 68 74 3a .....height:
00000230: 20 34 30 30 2c 0d 0a 20 20 20 20 09 09 09 09 09 400,.. .....
00000240: 70 6f 73 69 74 69 6f 6e 3a 20 7b 78 3a 20 27 63 position: {x: 'c
00000250: 65 6e 74 65 72 27 2c 20 79 3a 20 27 63 65 6e 74 enter', y: 'cent
00000260: 65 72 27 7d 2c 0d 0a 20 20 20 20 09 09 09 09 09 er'},.. .....
00000270: 74 69 74 6c 65 3a 20 22 22 2c 0d 0a 20 20 20 20 title: "",..
00000280: 09 09 09 09 09 62 75 74 74 6f 6e 54 65 78 74 3a .....buttonText:
00000290: 20 22 22 0d 0a 20 20 20 20 09 09 09 09 7d 09 0d "".. ....}..
000002a0: 0a 20 20 20 20 09 09 09 7d 3b 0d 0a 20 20 20 20 . ...};..
000002b0: 09 09 09 24 2e 65 78 74 65 6e 64 28 74 72 75 65 ...$.extend(true
000002c0: 2c 20 73 65 74 74 69 6e 67 73 2c 20 6f 70 74 69 , settings, opti
000002d0: 6f 6e 73 20 7c 7c 20 7b 7d 29 3b 20 20 20 20 09 ons || {}); .
000002e0: 09 09 0d 0a 20 20 20 20 09 09 09 72 65 74 75 72 .... ...retur
000002f0: 6e 20 74 68 69 73 2e 65 61 63 68 28 66 75 6e 63 n this.each(func
00000300: 74 69 6f 6e 20 28 29 20 7b 0d 0a 20 20 20 20 09 tion () {.. .
00000310: 09 09 09 63 6f 6e 73 6f 6c 65 2e 6c 6f 67 28 22 ...console.log("
00000320: 65 61 63 68 20 69 6e 76 6f 6b 65 64 20 66 6f 72 each invoked for
00000330: 20 74 68 69 73 3a 20 22 20 2b 20 74 68 69 73 20 this: " + this
00000340: 2b 20 22 20 77 69 74 68 20 69 64 3a 20 22 20 2b + " with id: " +
00000350: 20 74 68 69 73 2e 69 64 29 3b 0d 0a 20 20 20 20 this.id);..
00000360: 09 09 09 09 76 61 72 20 74 68 61 74 20 3d 20 74 ....var that = t
00000370: 68 69 73 3b 0d 0a 20 20 20 20 09 09 09 09 76 61 his;.. ....va
00000380: 72 20 6c 61 6e 67 75 61 67 65 20 3d 20 24 2e 65 r language = $.e
00000390: 78 74 65 6e 64 28 7b 7d 2c 20 24 2e 63 68 61 74 xtend({}, $.chat
000003a0: 2e 6c 61 6e 67 75 61 67 65 5b 22 65 6e 22 5d 2c .language["en"],
000003b0: 20 24 2e 63 68 61 74 2e 6c 61 6e 67 75 61 67 65 $.chat.language
000003c0: 5b 73 65 74 74 69 6e 67 73 2e 6c 61 6e 67 75 61 [settings.langua
000003d0: 67 65 5d 29 3b 0d 0a 20 20 20 20 09 09 09 09 76 ge]);.. ....v
000003e0: 61 72 20 6d 65 73 73 61 67 65 52 65 73 6f 6c 76 ar messageResolv
000003f0: 65 72 20 3d 20 6e 65 77 20 67 65 6e 65 72 61 6c er = new general
00000400: 2e 75 74 69 6c 2e 4d 65 73 73 61 67 65 52 65 73 .util.MessageRes
00000410: 6f 6c 76 65 72 28 6c 61 6e 67 75 61 67 65 2e 6d olver(language.m
00000420: 65 73 73 61 67 65 73 29 3b 0d 0a 20 20 20 20 09 essages);.. .
00000430: 09 09 09 76 61 72 20 24 75 6c 20 3d 20 24 28 27 ...var $ul = $('
00000440: 3c 75 6c 3e 27 29 3b 0d 0a 20 20 20 20 09 09 09 <ul>');.. ...
00000450: 09 76 61 72 20 64 65 66 65 72 20 3d 20 24 2e 44 .var defer = $.D
00000460: 65 66 65 72 72 65 64 28 29 3b 0d 0a 20 20 20 20 eferred();..
00000470: 09 09 09 09 76 61 72 20 73 6f 63 6b 65 74 44 65 ....var socketDe
00000480: 73 74 69 6e 61 74 69 6f 6e 20 3d 20 6e 65 77 20 stination = new
00000490: 53 6f 63 6b 4a 53 28 22 2f 61 6e 79 55 72 6c 50 SockJS("/anyUrlP
000004a0: 61 74 74 65 72 6e 2f 63 68 61 74 52 65 6c 61 79 attern/chatRelay
000004b0: 22 29 3b 0d 0a 20 20 20 20 09 09 09 09 74 68 61 ");.. ....tha
000004c0: 74 2e 73 74 6f 6d 70 43 6c 69 65 6e 74 44 65 73 t.stompClientDes
000004d0: 74 69 6e 61 74 69 6f 6e 20 3d 20 53 74 6f 6d 70 tination = Stomp
000004e0: 2e 6f 76 65 72 28 73 6f 63 6b 65 74 44 65 73 74 .over(socketDest
000004f0: 69 6e 61 74 69 6f 6e 29 3b 0d 0a 20 20 20 20 09 ination);.. .
00000500: 09 09 09 64 65 66 65 72 2e 70 72 6f 6d 69 73 65 ...defer.promise
00000510: 28 74 68 61 74 2e 73 74 6f 6d 70 43 6c 69 65 6e (that.stompClien
00000520: 74 44 65 73 74 69 6e 61 74 69 6f 6e 29 3b 0d 0a tDestination);..
00000530: 20 20 20 20 09 09 09 09 74 68 61 74 2e 73 74 6f ....that.sto
00000540: 6d 70 43 6c 69 65 6e 74 44 65 73 74 69 6e 61 74 mpClientDestinat
00000550: 69 6f 6e 2e 63 6f 6e 6e 65 63 74 28 7b 7d 2c 20 ion.connect({},
00000560: 66 75 6e 63 74 69 6f 6e 20 28 66 72 61 6d 65 29 function (frame)
00000570: 20 7b 0d 0a 20 20 20 20 09 09 09 09 09 64 65 66 {.. .....def
00000580: 65 72 2e 72 65 73 6f 6c 76 65 28 29 3b 0d 0a 09 er.resolve();...
00000590: 09 09 09 09 09 74 68 61 74 2e 73 74 6f 6d 70 43 .....that.stompC
000005a0: 6c 69 65 6e 74 44 65 73 74 69 6e 61 74 69 6f 6e lientDestination
000005b0: 2e 73 75 62 73 63 72 69 62 65 28 27 2f 65 78 63 .subscribe('/exc
000005c0: 68 61 6e 67 65 2f 63 68 61 74 44 69 72 65 63 74 hange/chatDirect
000005d0: 45 78 63 68 61 6e 67 65 2f 6d 65 73 73 61 67 65 Exchange/message
000005e0: 73 2d 27 20 2b 20 73 65 74 74 69 6e 67 73 2e 70 s-' + settings.p
000005f0: 61 72 61 6d 73 2e 75 73 65 72 4e 61 6d 65 20 2b arams.userName +
00000600: 20 27 2d 6e 6f 74 69 66 69 63 61 74 69 6f 6e 27 '-notification'
00000610: 2c 20 66 75 6e 63 74 69 6f 6e 20 28 66 72 61 6d , function (fram
00000620: 65 29 20 7b 0d 0a 09 09 09 09 09 09 09 76 61 72 e) {.........var
00000630: 20 24 62 6f 64 79 20 3d 20 4a 53 4f 4e 2e 70 61 $body = JSON.pa
00000640: 72 73 65 28 66 72 61 6d 65 2e 62 6f 64 79 29 3b rse(frame.body);
00000650: 0d 0a 09 09 09 09 09 09 09 2f 2f 20 49 66 20 74 .........// If t
00000660: 68 65 20 72 65 63 65 69 76 65 72 20 28 63 6c 69 he receiver (cli
00000670: 65 6e 74 20 2d 20 75 73 65 72 20 64 65 73 74 69 ent - user desti
00000680: 6e 61 74 69 6f 6e 29 20 6e 6f 74 69 66 69 65 73 nation) notifies
00000690: 20 6d 65 20 74 68 61 74 20 48 65 20 68 61 73 20 me that He has
000006a0: 72 65 63 65 69 76 65 64 20 74 68 65 20 6d 65 73 received the mes
000006b0: 73 61 67 65 20 74 68 61 74 20 49 20 73 65 6e 74 sage that I sent
000006c0: 0d 0a 09 09 09 09 09 09 09 69 66 20 28 24 62 6f .........if ($bo
000006d0: 64 79 2e 72 65 63 65 69 76 65 64 42 79 43 6c 69 dy.receivedByCli
000006e0: 65 6e 74 29 20 7b 0d 0a 09 09 09 09 09 09 09 09 ent) {..........
000006f0: 76 61 72 20 24 6c 69 20 3d 20 24 28 22 6c 69 3a var $li = $("li:
00000700: 63 6f 6e 74 61 69 6e 73 28 27 22 20 2b 20 24 62 contains('" + $b
00000710: 6f 64 79 2e 72 65 63 69 70 69 65 6e 74 20 2b 20 ody.recipient +
00000720: 22 27 29 22 2c 20 24 75 6c 29 3b 0d 0a 09 09 09 "')", $ul);.....
00000730: 09 09 09 09 09 76 61 72 20 24 75 73 65 72 56 69 .....var $userVi
00000740: 65 77 20 3d 20 24 6c 69 2e 64 61 74 61 28 27 75 ew = $li.data('u
00000750: 73 65 72 56 69 65 77 27 29 3b 0d 0a 09 09 09 09 serView');......
00000760: 09 09 09 09 24 75 73 65 72 56 69 65 77 2e 61 64 ....$userView.ad
00000770: 64 4d 65 73 73 61 67 65 28 24 62 6f 64 79 29 3b dMessage($body);
00000780: 0d 0a 09 09 09 09 09 09 09 7d 20 65 6c 73 65 20 .........} else
00000790: 69 66 20 28 24 28 22 6c 69 3a 63 6f 6e 74 61 69 if ($("li:contai
000007a0: 6e 73 28 27 22 20 2b 20 24 62 6f 64 79 2e 73 65 ns('" + $body.se
000007b0: 6e 64 65 72 20 2b 20 22 27 29 22 2c 20 24 75 6c nder + "')", $ul
000007c0: 29 2e 6c 65 6e 67 74 68 20 3c 20 31 29 20 7b 20 ).length < 1) {
000007d0: 2f 2f 20 41 64 64 20 74 68 65 20 63 6f 6e 74 61 // Add the conta
000007e0: 63 74 20 75 73 65 72 20 74 6f 20 74 68 65 20 6c ct user to the l
000007f0: 69 73 74 20 6f 66 20 63 6f 6e 74 61 63 74 20 75 ist of contact u
00000800: 73 65 72 73 20 63 6f 6e 6e 65 63 74 65 64 0d 0a sers connected..
00000810: 09 09 09 09 09 09 09 09 61 64 64 4c 69 74 6f 55 ........addLitoU
00000820: 6c 28 24 75 6c 2c 20 24 62 6f 64 79 2e 73 65 6e l($ul, $body.sen
00000830: 64 65 72 2c 20 73 65 74 74 69 6e 67 73 2c 20 6d der, settings, m
00000840: 65 73 73 61 67 65 52 65 73 6f 6c 76 65 72 2c 20 essageResolver,
00000850: 74 68 61 74 29 3b 0d 0a 09 09 09 09 09 09 09 7d that);.........}
00000860: 0d 0a 09 09 09 09 09 09 7d 29 3b 0d 0a 09 09 09 ........});.....
00000870: 09 09 7d 29 3b 0d 0a 20 20 20 20 09 09 09 09 24 ..});.. ....$
00000880: 2e 70 6f 73 74 28 73 65 74 74 69 6e 67 73 2e 70 .post(settings.p
00000890: 61 72 61 6d 73 2e 77 65 6c 63 6f 6d 65 55 72 6c arams.welcomeUrl
000008a0: 2c 20 7b 7d 2c 20 66 75 6e 63 74 69 6f 6e 28 20 , {}, function(
000008b0: 64 61 74 61 20 29 20 7b 0d 0a 20 20 20 20 09 09 data ) {.. ..
000008c0: 09 09 09 63 6f 6e 73 6f 6c 65 2e 6c 6f 67 28 22 ...console.log("
000008d0: 64 61 74 61 20 72 65 63 65 69 76 65 64 20 66 6f data received fo
000008e0: 72 20 22 20 2b 20 73 65 74 74 69 6e 67 73 2e 70 r " + settings.p
000008f0: 61 72 61 6d 73 2e 77 65 6c 63 6f 6d 65 55 72 6c arams.welcomeUrl
00000900: 20 20 2b 20 22 3a 20 22 20 2b 20 64 61 74 61 29 + ": " + data)
00000910: 3b 0d 0a 20 20 20 20 09 09 09 09 09 24 2e 65 61 ;.. .....$.ea
00000920: 63 68 28 64 61 74 61 2c 20 66 75 6e 63 74 69 6f ch(data, functio
00000930: 6e 20 28 69 6e 64 65 78 2c 20 76 61 6c 75 65 29 n (index, value)
00000940: 20 7b 0d 0a 20 20 20 20 09 09 09 09 09 09 61 64 {.. ......ad
00000950: 64 4c 69 74 6f 55 6c 28 24 75 6c 2c 20 76 61 6c dLitoUl($ul, val
00000960: 75 65 2c 20 73 65 74 74 69 6e 67 73 2c 20 6d 65 ue, settings, me
00000970: 73 73 61 67 65 52 65 73 6f 6c 76 65 72 2c 20 74 ssageResolver, t
00000980: 68 61 74 29 3b 20 20 20 09 09 09 09 09 09 0d 0a hat); ........
00000990: 20 20 20 20 09 09 09 09 09 7d 29 3b 0d 0a 20 20 .....});..
000009a0: 20 20 09 09 09 09 09 2f 2f 20 57 65 20 63 6f 6e .....// We con
000009b0: 6e 65 63 74 20 74 68 69 73 20 75 73 65 72 20 74 nect this user t
000009c0: 6f 20 72 65 63 65 69 76 65 20 6e 6f 74 69 66 69 o receive notifi
000009d0: 63 61 74 69 6f 6e 0d 0a 2f 2f 20 20 20 20 09 09 cation..// ..
000009e0: 09 09 09 76 61 72 20 73 6f 63 6b 65 74 44 65 73 ...var socketDes
000009f0: 74 69 6e 61 74 69 6f 6e 20 3d 20 6e 65 77 20 53 tination = new S
00000a00: 6f 63 6b 4a 53 28 22 68 74 74 70 73 3a 2f 2f 6e ockJS("https://n
00000a10: 65 77 77 65 62 73 6f 63 6b 65 74 61 70 69 74 65 ewwebsocketapite
00000a20: 73 74 2e 63 66 61 70 70 73 2e 69 6f 3a 34 34 34 st.cfapps.io:444
00000a30: 33 2f 61 6e 79 55 72 6c 50 61 74 74 65 72 6e 2f 3/anyUrlPattern/
00000a40: 63 68 61 74 52 65 6c 61 79 22 29 3b 09 09 09 09 chatRelay");....
00000a50: 09 09 0d 0a 20 20 20 20 09 09 09 09 09 24 28 74 .... .....$(t
00000a60: 68 61 74 29 2e 70 72 65 70 65 6e 64 28 24 75 6c hat).prepend($ul
00000a70: 29 3b 0d 0a 20 20 20 20 09 09 09 09 7d 29 3b 20 );.. ....});
00000a80: 20 20 20 09 09 09 09 0d 0a 20 20 20 20 09 09 09 ...... ...
00000a90: 7d 29 3b 0d 0a 20 20 20 20 09 09 7d 0d 0a 20 20 });.. ..}..
00000aa0: 20 20 7d 3b 0d 0a 20 20 20 20 0d 0a 20 20 20 20 };.. ..
00000ab0: 2f 2a 2a 0d 0a 20 20 20 20 20 2a 20 54 68 65 20 /**.. * The
00000ac0: 6d 61 69 6e 20 6d 65 74 68 6f 64 20 6f 66 20 74 main method of t
00000ad0: 68 69 73 20 70 6c 75 67 69 6e 2c 20 69 74 20 64 his plugin, it d
00000ae0: 6f 65 73 20 74 68 69 73 20 70 6c 75 67 69 6e 20 oes this plugin
00000af0: 74 6f 20 73 74 61 72 74 0d 0a 20 20 20 20 20 2a to start.. *
00000b00: 20 40 70 61 72 61 6d 20 7b 4f 62 6a 65 63 74 7d @param {Object}
00000b10: 20 6d 65 74 68 6f 64 20 54 68 65 20 6f 62 6a 65 method The obje
00000b20: 63 74 20 63 6f 6e 74 61 69 6e 69 6e 67 20 61 6c ct containing al
00000b30: 6c 20 74 68 65 20 63 6f 6e 66 69 67 75 72 61 74 l the configurat
00000b40: 69 6f 6e 20 6f 66 20 74 68 69 73 20 70 6c 75 67 ion of this plug
00000b50: 69 6e 20 28 74 68 65 20 6f 70 74 69 6f 6e 73 29 in (the options)
00000b60: 0d 0a 20 20 20 20 20 2a 2f 0d 0a 20 20 20 20 24 .. */.. $
00000b70: 2e 66 6e 2e 63 68 61 74 20 3d 20 66 75 6e 63 74 .fn.chat = funct
00000b80: 69 6f 6e 20 28 6d 65 74 68 6f 64 29 20 7b 0d 0a ion (method) {..
00000b90: 20 20 20 20 09 69 66 20 28 6d 65 74 68 6f 64 73 .if (methods
00000ba0: 5b 6d 65 74 68 6f 64 5d 29 20 7b 0d 0a 20 20 20 [method]) {..
00000bb0: 20 09 09 72 65 74 75 72 6e 20 6d 65 74 68 6f 64 ..return method
00000bc0: 73 5b 6d 65 74 68 6f 64 5d 2e 61 70 70 6c 79 28 s[method].apply(
00000bd0: 74 68 69 73 2c 20 41 72 72 61 79 2e 70 72 6f 74 this, Array.prot
00000be0: 6f 74 79 70 65 2e 73 6c 69 63 65 2e 63 61 6c 6c otype.slice.call
00000bf0: 28 61 72 67 75 6d 65 6e 74 73 2c 20 31 29 29 3b (arguments, 1));
00000c00: 0d 0a 20 20 20 20 09 7d 20 65 6c 73 65 20 69 66 .. .} else if
00000c10: 20 28 74 79 70 65 6f 66 20 6d 65 74 68 6f 64 20 (typeof method
00000c20: 3d 3d 3d 20 27 6f 62 6a 65 63 74 27 20 7c 7c 20 === 'object' ||
00000c30: 21 6d 65 74 68 6f 64 29 20 7b 0d 0a 20 20 20 20 !method) {..
00000c40: 09 09 72 65 74 75 72 6e 20 6d 65 74 68 6f 64 73 ..return methods
00000c50: 2e 5f 69 6e 69 74 2e 61 70 70 6c 79 28 74 68 69 ._init.apply(thi
00000c60: 73 2c 20 61 72 67 75 6d 65 6e 74 73 29 3b 0d 0a s, arguments);..
00000c70: 20 20 20 20 09 7d 20 65 6c 73 65 20 7b 0d 0a 20 .} else {..
00000c80: 20 20 20 09 09 72 65 74 75 72 6e 20 24 2e 65 72 ..return $.er
00000c90: 72 6f 72 28 22 4d 65 74 68 6f 64 20 22 20 2b 20 ror("Method " +
00000ca0: 6d 65 74 68 6f 64 20 2b 20 22 20 6e 6f 74 20 66 method + " not f
00000cb0: 6f 75 6e 64 20 69 6e 20 6a 71 75 65 72 79 2e 63 ound in jquery.c
00000cc0: 68 61 74 22 29 3b 0d 0a 20 20 20 20 09 7d 0d 0a hat");.. .}..
00000cd0: 20 20 20 20 7d 3b 0d 0a 20 20 20 20 0d 0a 20 20 };.. ..
00000ce0: 20 20 66 75 6e 63 74 69 6f 6e 20 61 64 64 4c 69 function addLi
00000cf0: 74 6f 55 6c 28 75 6c 2c 20 76 61 6c 75 65 2c 20 toUl(ul, value,
00000d00: 73 65 74 74 69 6e 67 73 2c 20 6d 65 73 73 61 67 settings, messag
00000d10: 65 52 65 73 6f 6c 76 65 72 2c 20 63 6f 6e 74 61 eResolver, conta
00000d20: 69 6e 65 72 29 20 7b 0d 0a 20 20 20 20 09 76 61 iner) {.. .va
00000d30: 72 20 24 6c 69 20 3d 20 24 28 27 3c 6c 69 3e 27 r $li = $('<li>'
00000d40: 29 3b 0d 0a 09 09 24 6c 69 2e 68 74 6d 6c 28 76 );....$li.html(v
00000d50: 61 6c 75 65 29 3b 0d 0a 09 09 76 61 72 20 75 73 alue);....var us
00000d60: 65 72 56 69 65 77 4f 70 74 69 6f 6e 73 20 3d 20 erViewOptions =
00000d70: 24 2e 65 78 74 65 6e 64 28 74 72 75 65 2c 20 7b $.extend(true, {
00000d80: 7d 2c 20 73 65 74 74 69 6e 67 73 2e 63 68 61 74 }, settings.chat
00000d90: 56 69 65 77 2c 20 7b 0d 0a 09 09 09 6d 65 73 73 View, {.....mess
00000da0: 61 67 65 52 65 73 6f 6c 76 65 72 3a 20 6d 65 73 ageResolver: mes
00000db0: 73 61 67 65 52 65 73 6f 6c 76 65 72 0d 0a 09 09 sageResolver....
00000dc0: 7d 29 3b 0d 0a 09 09 75 6c 2e 61 70 70 65 6e 64 });....ul.append
00000dd0: 28 24 6c 69 29 3b 0d 0a 09 09 76 61 72 20 75 73 ($li);....var us
00000de0: 65 72 56 69 65 77 20 3d 20 6e 65 77 20 63 68 61 erView = new cha
00000df0: 74 2e 76 69 65 77 2e 55 73 65 72 56 69 65 77 28 t.view.UserView(
00000e00: 75 73 65 72 56 69 65 77 4f 70 74 69 6f 6e 73 2c userViewOptions,
00000e10: 20 63 6f 6e 74 61 69 6e 65 72 2c 20 73 65 74 74 container, sett
00000e20: 69 6e 67 73 2c 20 24 6c 69 2c 20 6d 65 73 73 61 ings, $li, messa
00000e30: 67 65 52 65 73 6f 6c 76 65 72 29 3b 0d 0a 09 09 geResolver);....
00000e40: 24 6c 69 2e 64 61 74 61 28 27 75 73 65 72 56 69 $li.data('userVi
00000e50: 65 77 27 2c 20 75 73 65 72 56 69 65 77 29 3b 0d ew', userView);.
00000e60: 0a 20 20 20 20 7d 0d 0a 20 7d 29 3b 0d 0a . }.. });..